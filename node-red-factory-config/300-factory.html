<!--  *****Factory  -->
<script type="text/javascript">
    RED.nodes.registerType('factory',{
        category: 'factory',
		color:"BurlyWood",
        defaults: {
            name: {value:"",required:true},
            address: {value:"Address",required:true},
            outputs: {value:1},
        },
        inputs:1,
        outputs:1,
        icon: "serial.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });

</script>
<script type="text/html" data-template-name="factory">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-address"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.address"></span></label>
        <input type="text" id="node-input-address" placeholder="Address">
    </div>
</script>
<script type="text/html" data-help-name="factory">
    <p>Configuration of a factory.</p>
</script>

<!--  *****Areas  -->
<script type="text/javascript">
    RED.nodes.registerType('areas',{
        color:"#fdd0a2",
        category: 'factory',
        defaults: {
            name: {value:""},
            outputs: {value:1}   //,
            //noerr: {value:0,required:true,validate:function(v) { return !v; }}
        },
        inputs:1,
        outputs:1,
        icon: "function.svg",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            $( "#node-input-outputs" ).spinner({
                min:0,
                change: function(event, ui) {
                    var value = this.value;
                    if (!value.match(/^\d+$/)) { value = 1;  }
                    else if (value < this.min) { value = this.min; }
                    if (value !== this.value) { $(this).spinner("value", value); }
                }
            });
        },
        oneditsave: function() {
            //var node = this;
            //var noerr = 0;
            //$("#node-input-noerr").val(0);
        }
    });

</script>
<script type="text/html" data-template-name="areas">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" style="margin-bottom: 0px">
        <label for="node-input-outputs"><i class="fa fa-random"></i><span data-i18n="file_conf.label.outputs"></span></label>
        <input id="node-input-outputs" style="width: 60px;" value="1">
    </div>
</script>
<script type="text/html" data-help-name="areas">
    <p>Configuration of factory areas.</p>
</script>

<!--  *****Area  -->
<script type="text/javascript">
    RED.nodes.registerType('area',{
        color:"#fdd0a2",
        category: 'factory',
        defaults: {
            name: {value:""},
            comment: {value:"",required:true},
            outputs: {value:3}
        },
        inputs:1,
        outputs:2,
        icon: "function.svg",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });

</script>
<script type="text/html" data-template-name="area">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-comment"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.comment"></span></label>
        <input type="text" id="node-input-comment" placeholder="Comment">
    </div>
</script>
<script type="text/html" data-help-name="area">
    <p>Configuration of factory area.</p>
</script>

<!--  *****Tank Areas  -->
<script type="text/javascript">
    RED.nodes.registerType('tank_areas',{
        color:"#fdd0a2",
        category: 'factory',
        defaults: {
            name: {value:""},
            Area : {value:""},
            outputs: {value:1}
        },
        inputs:1,
        outputs:1,
        icon: "function.svg",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;

            // To fill the Selector Option
            var Checking = "area";
            var Select_values = [];
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            candidateNodes.forEach(function(n) {
                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                    if (sublabel === Checking) {
                        Select_values.push({value:label, text:label});
                    }
                }
            });
            for (var i = 0; i < Select_values.length; i++) {
               var value = Select_values[i].value;
               var text = Select_values[i].text;
               $('#node-input-Area').append($("<option></option>").attr("value", value).text(text));
            };
            // Make sure the selected value is also selected in the <select> tag
            $('#node-input-Area').val(this.Area);


            $( "#node-input-outputs" ).spinner({
                min:0,
                change: function(event, ui) {
                    var value = this.value;
                    if (!value.match(/^\d+$/)) { value = 1;  }
                    else if (value < this.min) { value = this.min; }
                    if (value !== this.value) { $(this).spinner("value", value); }
                }
            });
        },
        oneditsave: function() {
            //var node = this;
            //var noerr = 0;
            //$("#node-input-noerr").val(0);
        }
    });

</script>
<script type="text/html" data-template-name="tank_areas">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row" >
        <label for="node-input-Area"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.area"></span></label>
        <select type="text" id="node-input-Area" style="margin-left:11px; width:200px;">       <!--  height:28px;  -->
        </select>
    </div>

    <div class="form-row" style="margin-bottom: 0px">
        <label for="node-input-outputs"><i class="fa fa-random"></i><span data-i18n="function.label.output"></span></label>
        <input id="node-input-outputs" style="width: 60px;" value="1">
    </div>

</script>
<script type="text/html" data-help-name="tank_areas">
    <p>Configuration of factory Tank areas.</p>
</script>

<!--  *****Tank  -->
<script type="text/javascript">
    RED.nodes.registerType('tank',{
        color:"#fdd0a2",
        category: 'factory',
        defaults: {
            name: {value:""},
            InCollector: {value:"0"},
            OutCollector: {value:"0"},
            SelectCollector: {value: false},
            SelectLine: {value: false},
            Tank_Area : {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "timer.svg",
        label: function() {
            if (this.name) {
                return this.name;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;


            // To fill the Selector Option
            var Checking = "tank_areas";
            var Select_values = [];
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            candidateNodes.forEach(function(n) {
                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                    if (sublabel === Checking) {
                        Select_values.push({value:label, text:label});
                    }
                }
            });
            for (var i = 0; i < Select_values.length; i++) {
               var value = Select_values[i].value;
               var text = Select_values[i].text;
               $('#node-input-Tank_Area').append($("<option></option>").attr("value", value).text(text));
            };
            // Make sure the selected value is also selected in the <select> tag
            $('#node-input-Tank_Area').val(this.Tank_Area);

            if (this.InCollector === undefined) {
                this.InCollector = 0;
                $("#node-input-InCollector").val("0");
            }
            $("#node-input-InCollector").spinner({ min:0 });
            if (this.OutCollector === undefined) {
                this.OutCollector = 0;
                $("#node-input-OutCollector").val("0");
            }
            $("#node-input-OutCollector").spinner({ min:0 });
        },
		oneditsave: function() {

        }
    });

</script>
<script type="text/html" data-template-name="tank">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name">
    </div>

    <div class="form-row" >
        <label for="node-input-Tank_Area"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.tank_area"></span></label>
        <select type="text" id="node-input-Tank_Area" style="margin-left:11px; width:200px;">      <!--  height:28px;  -->
        </select>
    </div>

    <div class="form-row">
        <span data-i18n="file_conf.label.tank_design"></span><br/>
        <label>&nbsp;</label>
        <span data-i18n="file_conf.label.collector"></span><br/><input type="checkbox" checked id="node-input-SelectCollector" style="display:inline-block; width:auto; vertical-align:top;">
        <br/>
        <label>&nbsp;</label>
        <span data-i18n="file_conf.label.inline"></span><input type="checkbox" checked id="node-input-SelectLine" style="display:inline-block; width:auto; vertical-align:top;">
        <br/>
    </div>


    <div id="rate-input-coll">
        <div class="form-row">
            <label for="node-input-InCollector"><i class="fa fa-clock-o"></i><span data-i18n="file_conf.label.InColl"></span></label>
            <input type="text" id="node-input-InCollector" placeholder="1"
                   style="text-align:end; width:40px !important">
        </div>
    </div>
    <div id="rate-output-coll">
        <div class="form-row">
            <label for="node-input-OutCollector"><i class="fa fa-clock-o"></i><span data-i18n="file_conf.label.OutColl"></span></label>
            <input type="text" id="node-input-OutCollector" placeholder="1"
                   style="text-align:end; width:40px !important">
        </div>
    </div>

</script>
<script type="text/html" data-help-name="tank">
    <p>Configuration of one Tank.</p>
</script>
