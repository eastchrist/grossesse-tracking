


<!--  *****Equips  -->
<script type="text/javascript">
    RED.nodes.registerType('equips',{
        color:"#E6E0F8",
        category: 'equips',
        defaults: {
            name: {value:""},
            outputs: {value:1},
            noerr: {value:0,required:true,validate:function(v) { return !v; }}
        },
        inputs:1,
        outputs:1,
        icon: "function.svg",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            $( "#node-input-outputs" ).spinner({
                min:0,
                change: function(event, ui) {
                    var value = this.value;
                    if (!value.match(/^\d+$/)) { value = 1;  }
                    else if (value < this.min) { value = this.min; }
                    if (value !== this.value) { $(this).spinner("value", value); }
                }
            });
        },
        oneditsave: function() {
            var node = this;
            var noerr = 0;
            $("#node-input-noerr").val(0);
        }
    });
</script>
<script type="text/html" data-template-name="equips">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" style="margin-bottom: 0px">
        <label for="node-input-outputs"><i class="fa fa-random"></i><span data-i18n="file_conf.label.output"></span></label>
        <input id="node-input-outputs" style="width: 60px;" value="1">
    </div>
</script>
<script type="text/html" data-help-name="equips">
    <p>Configuration of factory Equips list.</p>
</script>

<!--  *****Equip Definition  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def',{
        category: 'config',
        defaults: {
            name: {value:""},
            Equip_Def_Digital: {type:"Equip_Def_Digital", required: true},
            Equip_Def_Analog: {type:"Equip_Def_Analog", required: true},
            Equip_Def_Alarms: {type:"Equip_Def_Alarms", required: true},
            Equip_Def_Carto: {type:"Equip_Def_Carto", required: true},
            Equip_Def_EventList: {type:"Equip_Def_EventList", required: true}
        },
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
        },
        oneditsave: function() {
            var node = this;
        }
    });
</script>
<script type="text/html" data-template-name="Equip_Def">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>

    <div class="form-row">
        <span data-i18n="file_conf.label.eventLabel"></span><br/>
    </div>

    <div class="form-row">
        <label for="node-config-input-Equip_Def_EventList"><i class="fa fa-table"></i><span data-i18n="file_conf.label.event"></span></label>
        <input type="text" id="node-config-input-Equip_Def_EventList">
    </div>

    <div class="form-row">
        <span data-i18n="file_conf.label.otherLabel"></span><br/>
    </div>

    <div class="form-row">
        <label for="node-config-input-Equip_Def_Digital"><i class="fa fa-table"></i><span data-i18n="file_conf.label.digital"></span></label>
        <input type="text" id="node-config-input-Equip_Def_Digital">
    </div>

    <div class="form-row">
        <label for="node-config-input-Equip_Def_Analog"><i class="fa fa-table"></i><span data-i18n="file_conf.label.analog"></span></label>
        <input type="text" id="node-config-input-Equip_Def_Analog">
    </div>

    <div class="form-row">
        <label for="node-config-input-Equip_Def_Alarms"><i class="fa fa-table"></i><span data-i18n="file_conf.label.alarms"></span></label>
        <input type="text" id="node-config-input-Equip_Def_Alarms">
    </div>
    <div class="form-row">
        <label for="node-config-input-Equip_Def_Carto"><i class="fa fa-table"></i><span data-i18n="file_conf.label.cartography"></span></label>
        <input type="text" id="node-config-input-Equip_Def_Carto">
    </div>


</script>

<!--  *****Equip Definition Digital  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_Digital',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            options: {
                        value:[{
                                    label :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            function generateOption(i, option) {
                var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                var row = $('<div/>').appendTo(containerTag);
                var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);

                $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                var labelField = $('<input/>',{class:"node-input-option-label", type:"text", style:"margin-left:7px; width:70%;", placeholder: 'e.g. Name', value:option.label}).appendTo(row);

                var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);

                var finalspan = $('<div/>',{style:"display:inline-block; width:5%;"}).appendTo(row);
                var deleteButton = $('<a/>',{
                        href:"#",
                        class:"editor-button",
                        style:"font-size:1.3em; vertical-align: middle;"
                }).appendTo(finalspan);
                $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                deleteButton.click(function() {
                    containerTag.css({"background":"#fee"});
                    containerTag.fadeOut(300, function() {
                        $(this).remove();
                });
            });

                $("#node-input-option-containerTag").append(containerTag);
            }

            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length+1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });

            for (var i=0; i<this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_Digital">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.digital"></span></label>
        <div style="display:inline-block; width:78%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                <div style="width:65%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag"></span></div>
                <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>

    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>

</script>
<!--  *****Equip Definition Analog  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_Analog',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            options: {
                        value:[{
                                    label :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            var Type_Array = [
                  {val : "Real", text: 'Real'},
                  {val : "Int", text: 'Int'},
                  {val : "Dint", text: 'Dint'},
                  {val : "Word", text: 'Word'},
                  {val : "Dword", text: 'Dword'}
                ];
            function generateOption(i, option) {
                var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                var row = $('<div/>').appendTo(containerTag);
                var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);

                $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                var labelField = $('<input/>',{class:"node-input-option-label", type:"text", style:"margin-left:7px; width:65%;", placeholder: 'e.g. Name', value:option.label}).appendTo(row);

                //**************************
                // Fill ComboBox Type
                var typeField = $('<select/>',{class:"node-input-option-type",type:"text",style:"margin-left:7px; width:16%"}).appendTo(row);
                $(Type_Array).each(function() {
                    var isSelected= false;
                    if (option.type == this.val) {
                        isSelected = true;
                    }
                    typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                });


                //***************************


                var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);

                var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                var deleteButton = $('<a/>',{
                        href:"#",
                        class:"editor-button",
                        style:"font-size:1.3em; vertical-align: middle;"
                }).appendTo(finalspan);
                $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                deleteButton.click(function() {
                    containerTag.css({"background":"#fee"});
                    containerTag.fadeOut(300, function() {
                        $(this).remove();
                });
            });

                $("#node-input-option-containerTag").append(containerTag);
            }

            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length+1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });

            for (var i=0; i<this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_Analog">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.analog"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">

        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:50%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag"></span></div>
                  <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.type"></span></div>
                  <div style="width:20%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>

    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>

</script>
<!--  *****Equip Definition Alarms  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_Alarms',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            options: {
                        value:[{
                                    label :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            var Type_Array = [
                  {val : "Real", text: 'Real'},
                  {val : "Int", text: 'Int'},
                  {val : "Dint", text: 'Dint'},
                  {val : "Word", text: 'Word'},
                  {val : "Dword", text: 'Dword'}
                ];
            function generateOption(i, option) {
                var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                var row = $('<div/>').appendTo(containerTag);
                var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);

                $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                var labelField = $('<input/>',{class:"node-input-option-label", type:"text", style:"margin-left:7px; width:65%;", placeholder: 'e.g. Name', value:option.label}).appendTo(row);

                //**************************
                // Fill ComboBox Type
                var typeField = $('<select/>',{class:"node-input-option-type",type:"text",style:"margin-left:7px; width:16%"}).appendTo(row);
                $(Type_Array).each(function() {
                    var isSelected= false;
                    if (option.type == this.val) {
                        isSelected = true;
                    }
                    typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                });
                //***************************


                var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);

                var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                var deleteButton = $('<a/>',{
                        href:"#",
                        class:"editor-button",
                        style:"font-size:1.3em; vertical-align: middle;"
                }).appendTo(finalspan);
                $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                deleteButton.click(function() {
                    containerTag.css({"background":"#fee"});
                    containerTag.fadeOut(300, function() {
                        $(this).remove();
                });
            });

                $("#node-input-option-containerTag").append(containerTag);
            }

            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length+1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });

            for (var i=0; i<this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_Alarms">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.alarms"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">

        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:50%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag"></span></div>
                  <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.type"></span></div>
                  <div style="width:20%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>

    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>

</script>
<!--  *****Equip Definition Carto  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_Carto',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            options: {
                        value:[{
                                    label :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            var Type_Array = [
                  {val : "PInit", text: 'Initial Push'},
                  {val : "PFinal", text: 'Final Push'},
                  {val : "Tank", text: 'Tank Emptying'},
                  {val : "Dosage", text: 'Dosage'}
                ];
            function generateOption(i, option) {
                var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                var row = $('<div/>').appendTo(containerTag);
                var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);

                $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                var labelField = $('<input/>',{class:"node-input-option-label", type:"text", style:"margin-left:7px; width:65%;", placeholder: 'e.g. Name', value:option.label}).appendTo(row);

                //**************************
                // Fill ComboBox Type
                var typeField = $('<select/>',{class:"node-input-option-type",type:"text",style:"margin-left:7px; width:16%"}).appendTo(row);

                $(Type_Array).each(function() {
                    var isSelected= false;
                    if (option.type == this.val) {
                        isSelected = true;
                    }
                    typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                });
                //***************************


                var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);

                var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                var deleteButton = $('<a/>',{
                        href:"#",
                        class:"editor-button",
                        style:"font-size:1.3em; vertical-align: middle;"
                }).appendTo(finalspan);
                $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                deleteButton.click(function() {
                    containerTag.css({"background":"#fee"});
                    containerTag.fadeOut(300, function() {
                        $(this).remove();
                });
            });

                $("#node-input-option-containerTag").append(containerTag);
            }

            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length+1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });

            for (var i=0; i<this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_Carto">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.cartography"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">

        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:50%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag"></span></div>
                  <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.type"></span></div>
                  <div style="width:20%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>

    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>
</script>

<!--  *****Equip Definition EventList  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_EventList',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            Equip_Def_EventM: {type:"Equip_Def_EventM", required: true},
            fifo_Def: {type:"fifo_Def", required: true},
            options: {
                        value:[
                                    {
                                    label : "" ,
                                    eventNb :'',
                                    type:''
                                    }
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
                var node = this;

                // Definition option Type "fifo_Def"
                var Type_Array_Fifo = [];
                var Def_fifo = $("#node-config-input-fifo_Def").children();
                for (var i=0; i < Def_fifo.length; i++) {
                    var o = {
                        val: Def_fifo[i].value,
                        text: Def_fifo[i].text
                    };
                    var Remove = Def_fifo[i].text.includes("Add new");
                    //console.log(Remove);
                    if (!Remove) {
                        Type_Array_Fifo.push(o);
                    }
                };

                // Definition option Label
                var Label_Array = [];
                var Def_EventMs = $("#node-config-input-Equip_Def_EventM").children();
                for (var i=0; i < Def_EventMs.length; i++) {
                    var o = {
                        val: Def_EventMs[i].value,
                        text: Def_EventMs[i].text
                    };
                    Label_Array.push(o);
                };

                //Function generateOption
                function generateOption(i, option) {
                        var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                        var row = $('<div/>').appendTo(containerTag);
                        var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                        var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);
                        $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                        // Fill Event Number Event Main
                        var valeur = parseInt(option.eventNb);
                        var eventNbField = $('<input/>',{
                                class:"node-input-option-eventNb",
                                type:"number",
                                style:"margin-left:7px; width:9%;",
                                //placeholder: 'e.g. Name',
                                min: "1",
                                max: "50",
                                value: valeur
                        }).appendTo(row);

                        // Fill Tag Event Main
                        var labelField = $('<select/>',{
                                class:"node-input-option-label",
                                type:"text",
                                style:"margin-left:7px; width:40%;",
                                value:option.label
                        }).appendTo(row);

                        $(Label_Array).each(function() {
                            var isSelected= false;
                            if (option.label == this.val) {
                                isSelected = true;
                            }
                            labelField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });

                        var nodeButton = $('<a/>',{
                                href:"#",
                                class:"editor-button",
                                style:"font-size:1.3em; vertical-align: middle;"
                        }).appendTo(row);
                        $('<i/>',{class:"fa fa-pencil"}).appendTo(nodeButton);


                        //**************************
                        // Fill ComboBox Type from fifo
                        var typeField = $('<select/>',{
                                class:"node-input-option-type",
                                type:"text",
                                style:"margin-left:7px; width:30%"
                        }).appendTo(row);
                        $(Type_Array_Fifo).each(function() {
                            var isSelected= false;
                            if (option.type == this.val) {
                                isSelected = true;
                            }
                            typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });

                        //***************************
                        var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:3%; vertical-align: middle"}).appendTo(row);
                        var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);
                        var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                        var deleteButton = $('<a/>',{
                                href:"#",
                                class:"editor-button",
                                style:"font-size:1.3em; vertical-align: middle;"
                        }).appendTo(finalspan);
                        $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                        deleteButton.click(function() {
                            containerTag.css({"background":"#fee"});
                            containerTag.fadeOut(300, function() {
                                $(this).remove();
                            });
                        });

                        nodeButton.click(function(e) {
                            var index = 0
                            var element = this.parentElement.children;
                            for (item in element) {
                                try {
                                    var classe = element[index].getAttribute("class");
                                    if (classe === "node-input-option-label") {
                                        document.getElementById("node-config-input-Equip_Def_EventM").selectedIndex = element[index].selectedIndex
                                        //console.log(element[index].selectedIndex)
                                        var Bouton = document.getElementById("node-config-input-lookup-Equip_Def_EventM");
                                        Bouton.click();
                                    }
                                } catch (error) {

                                }
                                index = index + 1;
                            }
                        //labelField.change(function(e){
                        //    var SelIndex = this.selectedIndex;
                        //    document.getElementById("node-config-input-Equip_Def_EventM").selectedIndex = SelIndex
                        //});
                });
                $("#node-input-option-containerTag").append(containerTag);

            };
            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length + 1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });
            for (var i=0; i < this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    eventNb: option.find(".node-input-option-eventNb").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-containerTag").children();
        //    var newWidth = ($("#node-input-option-containerTag").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_EventList">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <!--  style="display: none;"  -->
    <div class="form-row" >
        <span data-i18n="file_conf.label.toHide"></span><br/>
        <div class="form-row">
            <label for="node-config-input-Equip_Def_EventM"><i class="fa fa-table"></i><span data-i18n="file_conf.label.event_main"></span></label>
            <input type="text" id="node-config-input-Equip_Def_EventM">
        </div>

        <div class="form-row">
            <label for="node-config-input-fifo_Def"><i class="fa fa-table"></i><span data-i18n="file_conf.label.fifo_Def"></span></label>
            <input type="text" id="node-config-input-fifo_Def">
        </div>
    </div>

    <!--  style="display: none;"  -->
    <div class="form-row" >
        <span data-i18n="file_conf.label.toHide"></span><br/>
    </div>

    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.listEventM"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <div style="display:inline-block; width:100%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:10%; text-align:center; float:left;"><span data-i18n="file_conf.label.function_nb"></span></div>
                  <div style="width:48%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag_EventM"></span></div>
                  <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.type_Fifo"></span></div>
                  <div style="width:12%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>

    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>
</script>
<!--  *****Equip Definition Event Main  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_EventM',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            Equip_Def_EventS: {type:"Equip_Def_EventS", required: true},
            fifo_Def: {type:"fifo_Def", required: true},
            options: {
                        value:[{
                                    label :'',
                                    action :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
                // Type data for Data Event Main
                var Type_Array = [
                      {val : "Real", text: 'Real'},
                      {val : "Int", text: 'Int'},
                      {val : "Dint", text: 'Dint'},
                      {val : "Word", text: 'Word'},
                      {val : "Dword", text: 'Dword'},
                      {val : "String", text: 'String(10)'}
                ];
                // Action data for Data Event Main
                var Action_Array = [
                      {val : "B", text: 'B'},
                      {val : "E", text: 'E'},
                      {val : "E-B", text: 'E - B'},
                      {val : "B+E", text: 'B + E'},
                      {val : "B-E", text: 'B - E'}
                ];
                // Definition option Label
                var Label_Array = [];
                var Def_EventSs = $("#node-config-input-Equip_Def_EventS").children();
                for (var i=0; i < Def_EventSs.length; i++) {
                        var o = {
                                  val: Def_EventSs[i].value,
                                  text: Def_EventSs[i].text
                                };
                        Label_Array.push(o);
                };

                // Definition option Type "fifo_Def"
                var Type_Array_Fifo = [];
                var Def_fifo = $("#node-config-input-fifo_Def").children();
                for (var i=0; i < Def_fifo.length; i++) {
                    var o = {
                        val: Def_fifo[i].value,
                        text: Def_fifo[i].text
                    };
                    var Remove = Def_fifo[i].text.includes("Add new");
                    //console.log(Remove);
                    if (!Remove) {
                        Type_Array_Fifo.push(o);
                    }
                };
                // *************************************************************************************************
                // *************************************************************************************************
                // *************************************  EVENT MAIN DATA CONTAINER  *******************************
                // *************************************************************************************************
                // *************************************************************************************************
                function generateOption_Data_Container(i, option) {

                        var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                        var row = $('<div/>').appendTo(containerTag);
                        var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                        var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);
                        $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);
                        //**************************


                        // Fill Tag Event Main
                        var labelField = $('<input/>',{
                                class:"node-input-option-label",
                                type:"text",
                                style:"margin-left:7px; width:50%;",
                                placeholder: 'e.g. Name',
                                value:option.label
                        }).appendTo(row);
                        //**************************
                        // Fill ComboBox Action Event Main
                        var actionField = $('<select/>',{
                                class:"node-input-option-action",
                                type:"text",
                                style:"margin-left:7px; width:16%"
                        }).appendTo(row);
                        $(Action_Array).each(function() {
                            var isSelected= false;
                            if (option.action == this.val) {
                                isSelected = true;
                            }
                            actionField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });
                        // Fill ComboBox Type Event Main
                        var typeField = $('<select/>',{
                                class:"node-input-option-type",
                                type:"text",
                                style:"margin-left:7px; width:16%"
                        }).appendTo(row);
                        $(Type_Array).each(function() {
                            var isSelected= false;
                            if (option.type == this.val) {
                                isSelected = true;
                            }
                            typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });
                        //***************************
                        var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                        var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);
                        var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);

                        var deleteButton = $('<a/>',{
                                href:"#",
                                class:"editor-button",
                                style:"font-size:1.3em; vertical-align: middle;"
                        }).appendTo(finalspan);
                        $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                        deleteButton.click(function() {
                                containerTag.css({"background":"#fee"});
                                containerTag.fadeOut(300, function() {
                                    $(this).remove();
                                });
                        });
                        $("#node-input-option-containerTag").append(containerTag);
                };
                // *************************************************************************************************
                // *************************************************************************************************
                // ***************************************  EVENT SECOND CONTAINER  ********************************
                // *************************************************************************************************
                // *************************************************************************************************
                function generateOption_EventSecond_Container(i, option) {
                        var containerEvS = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                        var row = $('<div/>').appendTo(containerEvS);
                        var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerEvS);
                        var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerEvS);
                        $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                        // Fill Event Number Event Second
                        var valeur = parseInt(option.eventNb);
                        var eventNbField = $('<input/>',{
                                class:"node-input-option-eventNb",
                                type:"number",
                                style:"margin-left:7px; width:9%;",
                                //placeholder: 'e.g. Name',
                                min: "1",
                                max: "50",
                                value: valeur
                        }).appendTo(row);

                        // Fill Tag Event Second
                        var labelField = $('<select/>',{
                                class:"node-input-option-label",
                                type:"text",
                                style:"margin-left:7px; width:40%;",
                                value:option.label
                        }).appendTo(row);
                        //console.log("Pass 2");
                        $(Label_Array).each(function() {
                            var isSelected= false;
                            if (option.label == this.val) {
                                isSelected = true;
                            }
                            labelField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });

                        var nodeButton = $('<a/>',{
                                href:"#",
                                class:"editor-button",
                                style:"font-size:1.3em; vertical-align: middle;"
                        }).appendTo(row);
                        $('<i/>',{class:"fa fa-pencil"}).appendTo(nodeButton);

                        //**************************
                        // Fill ComboBox Type from fifo
                        var typeField = $('<select/>',{
                                class:"node-input-option-type",
                                type:"text",
                                style:"margin-left:7px; width:30%"
                        }).appendTo(row);
                        $(Type_Array_Fifo).each(function() {
                            var isSelected= false;
                            if (option.type == this.val) {
                                isSelected = true;
                            }
                            typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                        });

                        //console.log("Pass 3");

                        //***************************
                        var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:3%; vertical-align: middle"}).appendTo(row);
                        var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);
                        var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                        var deleteButton = $('<a/>',{
                                href:"#",
                                class:"editor-button",
                                style:"font-size:1.3em; vertical-align: middle;"
                        }).appendTo(finalspan);
                        $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                        deleteButton.click(function() {
                            containerEvS.css({"background":"#fee"});
                            containerEvS.fadeOut(300, function() {
                                $(this).remove();
                            });
                        });

                        //console.log("Pass 4");

                        nodeButton.click(function(e) {
                            //console.log("Click sur bouton ADD");
                            var index = 0
                            var element = this.parentElement.children;
                            for (item in element) {
									try {
											var classe = element[index].getAttribute("class");
											if (classe === "node-input-option-label") {
												document.getElementById("node-config-input-Equip_Def_EventS").selectedIndex = element[index].selectedIndex
												//console.log(element[index].selectedIndex)
												var Bouton = document.getElementById("node-config-input-lookup-Equip_Def_EventS");
												Bouton.click();
											}
									} catch (error) {
										}
									index = index + 1;
							}
                        });
                        $("#node-input-option-containerEvS").append(containerEvS);

                };
                $("#node-input-add-option_Data").click(function() {
                    generateOption_Data_Container($("#node-input-option-containerTag").children().length+1, {});
                    $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
                });
                $("#node-input-add-option_EventS").click(function() {
                    generateOption_EventSecond_Container($("#node-input-option-containerEvS").children().length+1, {});
                    $("#node-input-option-containerEvS-div").scrollTop($("#node-input-option-containerEvS-div").get(0).scrollHeight);
                });
                for (var i=0; i<this.options.length; i++) {
                    var options = this.options[i];
                    var option_Data = options.Data;
                    for (var d=0; d<option_Data.length; d++) {
                        var option = option_Data[d];
                        //console.log(option);
                        generateOption_Data_Container(d+1,option);
                    }
                    var option_SubFunct = options.SubFunct;
                    for (var d=0; d<option_SubFunct.length; d++) {
                        var option = option_SubFunct[d];
                        console.log(option);
                        generateOption_EventSecond_Container(d+1,option);
                    }
                }
        },
        oneditsave: function() {
            var node = this;
            node.options = [];
            //Reading Datas Event Main
            var optionsData = $("#node-input-option-containerTag").children();
            Datas = [];
            optionsData.each(function(i) {
                var option = $(this);
                var Data = {
                    label: option.find(".node-input-option-label").val(),
                    action: option.find(".node-input-option-action").val(),
                    type: option.find(".node-input-option-type").val()
                };
                Datas.push(Data);
            });
            //Reading Event Second of Event Main
            var optionsSubFunct = $("#node-input-option-containerEvS").children();
            SubFuncts = [];
            optionsSubFunct.each(function(i) {
                var option = $(this);
                var SubFunct = {
                    label: option.find(".node-input-option-label").val(),
                    eventNb: option.find(".node-input-option-eventNb").val(),
                    type: option.find(".node-input-option-type").val()
                };
                SubFuncts.push(SubFunct);
            });


            node.options = [ { "Data" : Datas , "SubFunct" : SubFuncts } ]
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_EventM">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>
    <!--  Definition Data Event  -->
    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.dataEvent"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:50%; text-align:center; float:left;"><span data-i18n="file_conf.label.dataEvent"></span></div>
                  <div style="width:8%; text-align:center; float:left;"><span data-i18n="file_conf.label.action"></span></div>
                  <div style="width:8%; text-align:center; float:left;"><span data-i18n="file_conf.label.type"></span></div>
                  <div style="width:8%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>
    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option_Data" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>
    <!--  Definition Event Second -->
    <!--  style="display: none;" -->
    <div class="form-row" >
        <span data-i18n="file_conf.label.toHide"></span><br/>
        <div class="form-row">
            <label for="node-config-input-Equip_Def_EventS"><i class="fa fa-table"></i><span data-i18n="file_conf.label.EventS"></span></label>
            <input type="text" id="node-config-input-Equip_Def_EventS">
        </div>
        <div class="form-row">
            <label for="node-config-input-fifo_Def"><i class="fa fa-table"></i><span data-i18n="file_conf.label.fifo_Def"></span></label>
            <input type="text" id="node-config-input-fifo_Def">
        </div>
    </div>
    <div class="form-row" >
        <span data-i18n="file_conf.label.toHide"></span><br/>
    </div>

    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.EventList"></span></label>
    </div>
    <div class="form-row node-input-option-containerEvS-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:10%; text-align:center; float:left;"><span data-i18n="file_conf.label.function_nb"></span></div>
                  <div style="width:30%; text-align:center; float:left;"><span data-i18n="file_conf.label.EventS"></span></div>
                  <div style="width:20%; text-align:center; float:left;"><span data-i18n="file_conf.label.type_Fifo"></span></div>
                  <div style="width:16%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerEvS-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerEvS" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>
    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option_EventS" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>
</script>
<!--  *****Equip Definition Event Second  -->
<script type="text/javascript">
    RED.nodes.registerType('Equip_Def_EventS',{
        category: 'config',
        color: 'rgb(176, 223, 227)',
        defaults: {
            name: {value: ''},
            options: {
                        value:[{
                                    label :'',
                                    action :'',
                                    type:''}
                                ],
                        validate:function(value) {
                            // TODO
                            //if (value.length ) {
                            //    for (var i = 0; i < value.length; i++) {
                            //        if (!value[i].value) {
                            //            return false;
                            //        }
                            //    }
                            //} else {
                            //    return false;
                            //}
                            return true;
                    }}
        },
        inputs:1,
        outputs:1,
        icon: "ui_form.png",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            var Type_Array = [
                  {val : "Real", text: 'Real'},
                  {val : "Int", text: 'Int'},
                  {val : "Dint", text: 'Dint'},
                  {val : "Word", text: 'Word'},
                  {val : "Dword", text: 'Dword'},
                  {val : "String", text: 'String(10)'}
            ];
            var Action_Array = [
                  {val : "B", text: 'B'},
                  {val : "E", text: 'E'},
                  {val : "E-B", text: 'E - B'},
                  {val : "B+E", text: 'B + E'},
                  {val : "B-E", text: 'B - E'}
            ];
            function generateOption(i, option) {
                var containerTag = $('<li/>',{style:"margin:0; padding:8px 0px 0px; border-bottom:1px solid #ccc;"});
                var row = $('<div/>').appendTo(containerTag);
                var row2 = $('<div/>',{style:"padding-top:5px; padding-left:175px;"}).appendTo(containerTag);
                var row3 = $('<div/>',{style:"padding-top:5px; padding-left:120px;"}).appendTo(containerTag);

                $('<i style="cursor:move; margin-left:3px;" class="node-input-option-handle fa fa-bars"></i>').appendTo(row);

                var labelField = $('<input/>',{class:"node-input-option-label", type:"text", style:"margin-left:7px; width:50%;", placeholder: 'e.g. Name', value:option.label}).appendTo(row);

                //**************************
                // Fill ComboBox Action
                var actionField = $('<select/>',{class:"node-input-option-action",type:"text",style:"margin-left:7px; width:16%"}).appendTo(row);
                $(Action_Array).each(function() {
                    var isSelected= false;
                    if (option.action == this.val) {
                        isSelected = true;
                    }
                    actionField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                });
                // Fill ComboBox Type
                var typeField = $('<select/>',{class:"node-input-option-type",type:"text",style:"margin-left:7px; width:16%"}).appendTo(row);
                $(Type_Array).each(function() {
                    var isSelected= false;
                    if (option.type == this.val) {
                        isSelected = true;
                    }
                    typeField.append($("<option>").attr('value',this.val).text(this.text).prop('selected',isSelected));
                });
                //***************************
                var requiredcontainerTag= $('<div/>',{style:"display:inline-block; height:34px; width:5%; vertical-align: middle"}).appendTo(row);
                var requiredInnercontainerTag= $('<div/>',{style:"left:35%; position:relative; width:20px"}).appendTo(requiredcontainerTag);

                var finalspan = $('<div/>',{style:"display:inline-block; width:2%;"}).appendTo(row);
                var deleteButton = $('<a/>',{
                        href:"#",
                        class:"editor-button",
                        style:"font-size:1.3em; vertical-align: middle;"
                }).appendTo(finalspan);
                $('<i/>',{class:"fa fa-trash-o"}).appendTo(deleteButton);

                deleteButton.click(function() {
                    containerTag.css({"background":"#fee"});
                    containerTag.fadeOut(300, function() {
                        $(this).remove();
                });
            });

                $("#node-input-option-containerTag").append(containerTag);
            }

            $("#node-input-add-option").click(function() {
                generateOption($("#node-input-option-containerTag").children().length+1, {});
                $("#node-input-option-containerTag-div").scrollTop($("#node-input-option-containerTag-div").get(0).scrollHeight);
            });

            for (var i=0; i<this.options.length; i++) {
                var option = this.options[i];
                generateOption(i+1,option);
            }
        },
        oneditsave: function() {
            var options = $("#node-input-option-containerTag").children();
            var node = this;
            node.options = [];
            //node.formValue = {};
            options.each(function(i) {
                var option = $(this);
                var o = {
                    label: option.find(".node-input-option-label").val(),
                    action: option.find(".node-input-option-action").val(),
                    type: option.find(".node-input-option-type").val()
                };
                //node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
                node.options.push(o);
            });
        }  //,
        //oneditresize: function() {
        //    var options = $("#node-input-option-container").children();
        //    var newWidth = ($("#node-input-option-container").width() - 175)/2;
        //    var node = this;
        //    options.each(function(i) {
        //        node.resizeRule($(this),newWidth);
        //    });
        //}
    });
</script>
<script type="text/html" data-template-name="Equip_Def_EventS">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>
    <!--  Definition Data Event  -->
    <div class="form-row">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i><span data-i18n="file_conf.label.dataEvent"></span></label>
    </div>
    <div class="form-row node-input-option-containerTag-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <div style="display:inline-block; width:95%; border:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
          <div class="red-ui-tray-header" style="width:100%; display: inline-block; padding-top:10px; padding-buttom:10px; border-top:0px solid; border-radius:5px 5px 0 0; border-bottom:1px solid #ccc;">
              <div style="width:94%; display:inline-block; margin-left:27px">
                  <div style="width:50%; text-align:center; float:left;"><span data-i18n="file_conf.label.tag"></span></div>
                  <div style="width:16%; text-align:center; float:left;"><span data-i18n="file_conf.label.action"></span></div>
                  <div style="width:18%; text-align:center; float:left;"><span data-i18n="file_conf.label.type"></span></div>
                  <div style="width:16%; text-align:center; float:left;"><span data-i18n="file_conf.label.remove"></span></div>
              </div>
          </div>
          <div id="node-input-option-containerTag-div" style=" height: 280px; padding: 5px; overflow-y:scroll;">
            <ol id="node-input-option-containerTag" style=" list-style-type:none; margin: 0;"></ol>
          </div>
        </div>
    </div>
    <div class="form-row">
        <a href="#" class="editor-button editor-button-small" id="node-input-add-option" style="margin-top: 4px; margin-left: 103px;"><i class="fa fa-plus"></i> <span>element</span></a>
    </div>
</script>


<!--  *****Equip  -->
<script type="text/javascript">
    RED.nodes.registerType('equip_Type',{
        color:"#E6E0F8",
        category: 'equips',
        defaults: {
            name: {value:""},
            Plc : {value:""},
            Equip_Def: {value:"", type:"Equip_Def"}
        },
        inputs:1,
        outputs:1,
        icon: "function.svg",
        label: function() {
            return this.name || "";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;

            // To fill the Selector Option
            var Checking = "Plc_Type";
            var Select_values = [];
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            candidateNodes.forEach(function(n) {
                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                    if (sublabel === Checking) {
                        Select_values.push({value:label, text:label});
                    }
                }
            });
            for (var i = 0; i < Select_values.length; i++) {
               var value = Select_values[i].value;
               var text = Select_values[i].text;
               $('#node-input-Plc').append($("<option></option>").attr("value", value).text(text));
            };
            // Make sure the selected value is also selected in the <select> tag
            $('#node-input-Plc').val(this.Plc);

        },
        oneditsave: function() {
            var node = this;
        }
    });
</script>
<script type="text/html" data-template-name="equip_Type">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row" >
        <label for="node-input-Plc"><i class="fa fa-tag"></i><span data-i18n="file_conf.label.plc"></span></label>
        <select type="text" id="node-input-Plc" style="margin-left:11px; width:200px;"> <!--  height:28px;  -->
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-Equip_Def"><i class="fa fa-table"></i><span data-i18n="file_conf.label.definition"></span></label>
        <input type="text" id="node-input-Equip_Def">
    </div>
</script>
<script type="text/html" data-help-name="equip_Type">
    <p>Configuration of one Equipement.</p>
</script>

